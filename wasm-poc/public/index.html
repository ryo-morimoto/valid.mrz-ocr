<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MRZ WASM PoC æ¤œè¨¼ - YOLOv8 + Tesseract.js</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 { color: #333; }
    .card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .status { font-weight: bold; }
    .success { color: #22c55e; }
    .error { color: #ef4444; }
    .pending { color: #f59e0b; }
    pre {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 13px;
      max-height: 400px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 10px 0;
    }
    th, td {
      text-align: left;
      padding: 8px 12px;
      border-bottom: 1px solid #eee;
    }
    th { background: #f9f9f9; }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover { background: #2563eb; }
    button:disabled { background: #9ca3af; cursor: not-allowed; }
    .metric { font-family: monospace; }
    .architecture {
      background: #fefce8;
      border: 1px solid #fde047;
      border-radius: 4px;
      padding: 15px;
      margin: 10px 0;
    }
    .architecture code {
      background: #fff;
      padding: 2px 6px;
      border-radius: 2px;
    }
  </style>
</head>
<body>
  <h1>ğŸ” MRZ WASM PoC æ¤œè¨¼</h1>

  <div class="card architecture">
    <strong>ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</strong>
    <p>
      <code>YOLOv8-nano</code> (Detection, æ¯ãƒ•ãƒ¬ãƒ¼ãƒ  ~100ms) â†’
      å®‰å®šæ¤œå‡ºæ™‚ â†’
      <code>Tesseract.js</code> (Recognition, ãƒ¯ãƒ³ã‚·ãƒ§ãƒƒãƒˆ ~200ms)
    </p>
  </div>

  <div class="card">
    <h2>æ¤œè¨¼é …ç›®</h2>
    <table>
      <tr>
        <th>é …ç›®</th>
        <th>æˆåŠŸåŸºæº–</th>
        <th>çŠ¶æ…‹</th>
      </tr>
      <tr>
        <td>YOLOv8-nano ONNX â†’ WASM</td>
        <td>æ¨è«– &lt; 200ms</td>
        <td id="yolo-status" class="status pending">â³ æœªå®Ÿè¡Œ</td>
      </tr>
      <tr>
        <td>Tesseract.js (WASM)</td>
        <td>èªè­˜ &lt; 500ms</td>
        <td id="tesseract-status" class="status pending">â³ æœªå®Ÿè¡Œ</td>
      </tr>
      <tr>
        <td>åˆè¨ˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ™‚é–“</td>
        <td>&lt; 700ms</td>
        <td id="speed-status" class="status pending">â³ æœªè¨ˆæ¸¬</td>
      </tr>
      <tr>
        <td>ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</td>
        <td>&lt; 500MB</td>
        <td id="memory-status" class="status pending">â³ æœªè¨ˆæ¸¬</td>
      </tr>
    </table>

    <button id="run-btn" onclick="runAllTests()">ğŸš€ æ¤œè¨¼å®Ÿè¡Œ</button>
  </div>

  <div class="card">
    <h2>è©³ç´°ãƒ­ã‚°</h2>
    <pre id="log">æ¤œè¨¼ã‚’é–‹å§‹ã™ã‚‹ã«ã¯ä¸Šã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚

å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«:
- models/yolov8n.onnx

ãƒ¢ãƒ‡ãƒ«ãŒãªã„å ´åˆã¯ä»¥ä¸‹ã‚’å®Ÿè¡Œ:
  cd wasm-poc
  python scripts/export_yolo.py

Tesseract.js ã¯ CDN ã‹ã‚‰è‡ªå‹•ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚
</pre>
  </div>

  <div class="card">
    <h2>è¨ˆæ¸¬çµæœ</h2>
    <table>
      <tr>
        <th>ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ</th>
        <th>ãƒ­ãƒ¼ãƒ‰æ™‚é–“</th>
        <th>æ¨è«–/èªè­˜æ™‚é–“</th>
        <th>å‚™è€ƒ</th>
      </tr>
      <tr>
        <td>YOLOv8-nano (Detection)</td>
        <td id="yolo-load" class="metric">-</td>
        <td id="yolo-infer" class="metric">-</td>
        <td>æ¯ãƒ•ãƒ¬ãƒ¼ãƒ å®Ÿè¡Œ</td>
      </tr>
      <tr>
        <td>Tesseract.js (Recognition)</td>
        <td id="tesseract-load" class="metric">-</td>
        <td id="tesseract-infer" class="metric">-</td>
        <td>å®‰å®šæ¤œå‡ºæ™‚ã®ã¿</td>
      </tr>
      <tr style="font-weight: bold;">
        <td>åˆè¨ˆ (ãƒ¯ãƒ³ã‚·ãƒ§ãƒƒãƒˆ)</td>
        <td id="total-load" class="metric">-</td>
        <td id="total-infer" class="metric">-</td>
        <td id="total-mem" class="metric">-</td>
      </tr>
    </table>
  </div>

  <!-- Tesseract.js v5 CDN -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

  <script type="module">
    /**
     * MRZ WASM PoC æ¤œè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
     *
     * ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®æ¤œè¨¼:
     * 1. YOLOv8-nano: MRZ é ˜åŸŸæ¤œå‡ºï¼ˆæ¯ãƒ•ãƒ¬ãƒ¼ãƒ å®Ÿè¡Œæƒ³å®šï¼‰
     * 2. Tesseract.js: MRZ æ–‡å­—èªè­˜ï¼ˆå®‰å®šæ¤œå‡ºæ™‚ã®ã¿å®Ÿè¡Œï¼‰
     *
     * ç›®æ¨™: Detection <200ms + Recognition <500ms = Total <700ms
     */
    import * as ort from 'https://cdn.jsdelivr.net/npm/onnxruntime-web@1.17.0/dist/esm/ort.min.js';

    // WASM ãƒ•ã‚¡ã‚¤ãƒ«ã® CDN ãƒ‘ã‚¹è¨­å®š
    ort.env.wasm.wasmPaths = 'https://cdn.jsdelivr.net/npm/onnxruntime-web@1.17.0/dist/';

    // SIMD ã¨ ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰æœ‰åŠ¹åŒ–
    ort.env.wasm.simd = true;
    ort.env.wasm.numThreads = navigator.hardwareConcurrency || 4;

    const logEl = document.getElementById('log');
    let logText = '';

    // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆãƒšãƒ¼ã‚¸å†…ã§å†åˆ©ç”¨ï¼‰
    let cachedYoloSession = null;

    /**
     * ãƒ­ã‚°å‡ºåŠ›é–¢æ•°
     * ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¨ç”»é¢ä¸¡æ–¹ã«å‡ºåŠ›ã™ã‚‹
     */
    function log(msg) {
      logText += msg + '\n';
      logEl.textContent = logText;
      logEl.scrollTop = logEl.scrollHeight;
      console.log(msg);
    }

    /**
     * ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚’å–å¾—ï¼ˆChrome ã®ã¿å¯¾å¿œï¼‰
     * ä»–ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã¯ 'N/A' ã‚’è¿”ã™
     */
    function getMemoryMB() {
      if (performance.memory) {
        return (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(1);
      }
      return 'N/A';
    }

    /**
     * ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚’æ›´æ–°
     * @param {string} id - å¯¾è±¡è¦ç´ ã®ID
     * @param {boolean} success - æˆåŠŸ/å¤±æ•—
     * @param {string} text - è¡¨ç¤ºãƒ†ã‚­ã‚¹ãƒˆ
     */
    function setStatus(id, success, text) {
      const el = document.getElementById(id);
      el.className = 'status ' + (success ? 'success' : 'error');
      el.textContent = text;
    }

    /**
     * YOLOv8-nano å‹•ä½œæ¤œè¨¼
     *
     * MRZ é ˜åŸŸæ¤œå‡ºç”¨ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ¤œå‡ºãƒ¢ãƒ‡ãƒ«ã€‚
     * æ¯ãƒ•ãƒ¬ãƒ¼ãƒ ï¼ˆç´„30fps = 33msé–“éš”ï¼‰ã§ã®å®Ÿè¡Œã‚’æƒ³å®šã€‚
     *
     * å…¥åŠ›: [1, 3, 320, 320] (NCHWå½¢å¼ã€RGBç”»åƒ)
     * å‡ºåŠ›: [1, 84, 2100] (84 = 4åº§æ¨™ + 80ã‚¯ãƒ©ã‚¹ç¢ºç‡)
     */
    async function testYolo() {
      log('\n[1/2] YOLOv8-nano WASM æ¤œè¨¼ (Detection)');
      log('â”€'.repeat(40));

      const memBefore = parseFloat(getMemoryMB()) || 0;
      const results = { success: false, loadTime: 0, inferTime: 0, memDelta: 0 };

      try {
        // ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‰ï¼ˆåˆå›ã®ã¿ã€ä»¥é™ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹ï¼‰
        log('  ãƒ¢ãƒ‡ãƒ«ãƒ­ãƒ¼ãƒ‰ä¸­...');
        const loadStart = performance.now();
        // ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦å†åˆ©ç”¨ï¼ˆå®Ÿéš›ã®ã‚¢ãƒ—ãƒªã¨åŒã˜å‹•ä½œï¼‰
        if (!cachedYoloSession) {
          cachedYoloSession = await ort.InferenceSession.create(
            './models/yolov8n.onnx',
            {
              executionProviders: ['wasm'],
              graphOptimizationLevel: 'all'
            }
          );
          results.loadTime = performance.now() - loadStart;
          log(`  âœ“ ãƒ­ãƒ¼ãƒ‰å®Œäº†: ${results.loadTime.toFixed(0)}ms (åˆå›)`);
        } else {
          results.loadTime = performance.now() - loadStart;
          log(`  âœ“ ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¸ˆã¿: ${results.loadTime.toFixed(0)}ms`);
        }
        const session = cachedYoloSession;

        // å…¥å‡ºåŠ›æƒ…å ±è¡¨ç¤º
        log(`  å…¥åŠ›: ${session.inputNames.join(', ')}`);
        log(`  å‡ºåŠ›: ${session.outputNames.join(', ')}`);

        // ãƒ€ãƒŸãƒ¼å…¥åŠ›ã§æ¨è«–ãƒ†ã‚¹ãƒˆï¼ˆå®Ÿéš›ã¯ã‚«ãƒ¡ãƒ©ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’å…¥åŠ›ï¼‰
        // 320x320 ã«ç¸®å°ã—ã¦é«˜é€ŸåŒ–ï¼ˆMRZæ¤œå‡ºã«ã¯ååˆ†ãªè§£åƒåº¦ï¼‰
        const inputShape = [1, 3, 320, 320];
        const inputData = new Float32Array(1 * 3 * 320 * 320).fill(0.5);
        const inputTensor = new ort.Tensor('float32', inputData, inputShape);

        log('  æ¨è«–å®Ÿè¡Œä¸­...');
        const inferStart = performance.now();
        const output = await session.run({ images: inputTensor });
        results.inferTime = performance.now() - inferStart;

        // å‡ºåŠ›å½¢çŠ¶ç¢ºèª
        const outputTensor = output[session.outputNames[0]];
        log(`  âœ“ æ¨è«–å®Œäº†: ${results.inferTime.toFixed(0)}ms`);
        log(`  å‡ºåŠ›å½¢çŠ¶: [${outputTensor.dims.join(', ')}]`);

        const memAfter = parseFloat(getMemoryMB()) || 0;
        results.memDelta = memAfter - memBefore;
        results.success = true;
        log('  âœ… YOLOv8-nano: SUCCESS');

      } catch (error) {
        log(`  âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
        if (error.message.includes('Could not fetch')) {
          log('  â†’ models/yolov8n.onnx ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
          log('  â†’ python scripts/export_yolo.py ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„');
        }
        results.success = false;
      }

      return results;
    }

    /**
     * Tesseract.js å‹•ä½œæ¤œè¨¼
     *
     * MRZ æ–‡å­—èªè­˜ç”¨ã® OCR ã‚¨ãƒ³ã‚¸ãƒ³ã€‚
     * YOLOv8 ã§æ¤œå‡ºã—ãŸ MRZ é ˜åŸŸã«å¯¾ã—ã¦ã®ã¿å®Ÿè¡Œï¼ˆãƒ¯ãƒ³ã‚·ãƒ§ãƒƒãƒˆï¼‰ã€‚
     *
     * ç‰¹å¾´:
     * - ãƒ–ãƒ©ã‚¦ã‚¶ãƒã‚¤ãƒ†ã‚£ãƒ– WASM å®Ÿè£…
     * - MRZ ã«ç‰¹åŒ–ã—ãŸè¨­å®šå¯èƒ½ï¼ˆwhitelist, PSMï¼‰
     * - åˆå›ãƒ­ãƒ¼ãƒ‰ã¯é…ã„ãŒã€2å›ç›®ä»¥é™ã¯é«˜é€Ÿ
     */
    async function testTesseract() {
      log('\n[2/2] Tesseract.js WASM æ¤œè¨¼ (Recognition)');
      log('â”€'.repeat(40));

      const memBefore = parseFloat(getMemoryMB()) || 0;
      const results = { success: false, loadTime: 0, inferTime: 0, memDelta: 0 };

      try {
        // Worker åˆæœŸåŒ–ï¼ˆåˆå›ã®ã¿é…ã„ã€ä»¥é™ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
        log('  Tesseract Worker åˆæœŸåŒ–ä¸­...');
        const loadStart = performance.now();

        const worker = await Tesseract.createWorker('eng', 1, {
          logger: m => {
            // ãƒ­ãƒ¼ãƒ‰é€²æ—ã‚’è¡¨ç¤º
            if (m.status === 'loading tesseract core') {
              log('    â†’ Tesseract ã‚³ã‚¢ãƒ­ãƒ¼ãƒ‰ä¸­...');
            } else if (m.status === 'initializing api') {
              log('    â†’ API åˆæœŸåŒ–ä¸­...');
            }
          }
        });

        results.loadTime = performance.now() - loadStart;
        log(`  âœ“ Worker åˆæœŸåŒ–å®Œäº†: ${results.loadTime.toFixed(0)}ms`);

        // MRZ èªè­˜ç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š
        // PSM 6: å˜ä¸€ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ–ãƒ­ãƒƒã‚¯ã¨ã—ã¦èªè­˜
        // Whitelist: MRZ ã§ä½¿ç”¨ã•ã‚Œã‚‹æ–‡å­—ã®ã¿
        await worker.setParameters({
          tessedit_char_whitelist: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789<',
          tessedit_pageseg_mode: '6'
        });
        log('  MRZ ç”¨ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®šå®Œäº†');

        // ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ€ãƒŸãƒ¼ MRZ ç”»åƒã‚’ç”Ÿæˆï¼ˆCanvas ã§ä½œæˆï¼‰
        const canvas = document.createElement('canvas');
        canvas.width = 320;
        canvas.height = 48;
        const ctx = canvas.getContext('2d');

        // ç™½èƒŒæ™¯
        ctx.fillStyle = '#fff';
        ctx.fillRect(0, 0, 320, 48);

        // MRZ é¢¨ã®ãƒ†ã‚­ã‚¹ãƒˆã‚’æç”»ï¼ˆå®Ÿéš›ã¯ã‚«ãƒ¡ãƒ©ã‹ã‚‰ã®ã‚¯ãƒ­ãƒƒãƒ—ç”»åƒï¼‰
        ctx.fillStyle = '#000';
        ctx.font = 'bold 16px monospace';
        ctx.fillText('P<UTOERIKSSON<<ANNA<MARIA<<<<<<<<<<<<<<', 5, 20);
        ctx.fillText('L898902C36UTO7408122F1204159<<<<<<<<<6', 5, 40);

        log('  ãƒ†ã‚¹ãƒˆç”»åƒç”Ÿæˆå®Œäº† (320x48 MRZé¢¨)');

        // OCR å®Ÿè¡Œ
        log('  èªè­˜å®Ÿè¡Œä¸­...');
        const inferStart = performance.now();
        const { data: { text } } = await worker.recognize(canvas);
        results.inferTime = performance.now() - inferStart;

        log(`  âœ“ èªè­˜å®Œäº†: ${results.inferTime.toFixed(0)}ms`);
        log(`  èªè­˜çµæœ: ${text.replace(/\n/g, ' ').substring(0, 50)}...`);

        // Worker çµ‚äº†ï¼ˆå®Ÿéš›ã®å®Ÿè£…ã§ã¯ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ã¦å†åˆ©ç”¨ï¼‰
        await worker.terminate();

        const memAfter = parseFloat(getMemoryMB()) || 0;
        results.memDelta = memAfter - memBefore;
        results.success = true;
        log('  âœ… Tesseract.js: SUCCESS');

      } catch (error) {
        log(`  âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
        console.error(error);
        results.success = false;
      }

      return results;
    }

    /**
     * å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
     *
     * ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®æ¤œè¨¼:
     * 1. YOLOv8-nano ã§ MRZ é ˜åŸŸã‚’æ¤œå‡º
     * 2. å®‰å®šæ¤œå‡ºã‚’ç¢ºèªï¼ˆå®Ÿè£…æ™‚ã¯3ãƒ•ãƒ¬ãƒ¼ãƒ é€£ç¶šãªã©ï¼‰
     * 3. Tesseract.js ã§ MRZ æ–‡å­—ã‚’èªè­˜
     */
    async function runAllTests() {
      const btn = document.getElementById('run-btn');
      btn.disabled = true;
      btn.textContent = 'â³ æ¤œè¨¼ä¸­...';

      logText = '';
      log('='.repeat(50));
      log('MRZ WASM PoC æ¤œè¨¼é–‹å§‹');
      log('='.repeat(50));
      log(`ãƒ–ãƒ©ã‚¦ã‚¶: ${navigator.userAgent.split(' ').pop()}`);
      log(`åˆæœŸãƒ¡ãƒ¢ãƒª: ${getMemoryMB()} MB`);
      log(`CPUã‚³ã‚¢æ•°: ${navigator.hardwareConcurrency || 'N/A'}`);
      log('');
      log('ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£:');
      log('  Detection: YOLOv8-nano (æ¯ãƒ•ãƒ¬ãƒ¼ãƒ  ~100ms)');
      log('  Recognition: Tesseract.js (å®‰å®šæ¤œå‡ºæ™‚ã®ã¿)');

      // YOLOv8-nano ãƒ†ã‚¹ãƒˆ
      const yoloResults = await testYolo();
      document.getElementById('yolo-load').textContent = `${yoloResults.loadTime.toFixed(0)}ms`;
      document.getElementById('yolo-infer').textContent = `${yoloResults.inferTime.toFixed(0)}ms`;
      const yoloOk = yoloResults.success && yoloResults.inferTime < 200;
      setStatus('yolo-status', yoloOk,
        yoloOk ? `âœ… ${yoloResults.inferTime.toFixed(0)}ms` : `âŒ ${yoloResults.inferTime.toFixed(0)}ms`);

      // Tesseract.js ãƒ†ã‚¹ãƒˆ
      const tesseractResults = await testTesseract();
      document.getElementById('tesseract-load').textContent = `${tesseractResults.loadTime.toFixed(0)}ms`;
      document.getElementById('tesseract-infer').textContent = `${tesseractResults.inferTime.toFixed(0)}ms`;
      const tesseractOk = tesseractResults.success && tesseractResults.inferTime < 500;
      setStatus('tesseract-status', tesseractOk,
        tesseractOk ? `âœ… ${tesseractResults.inferTime.toFixed(0)}ms` : `âŒ ${tesseractResults.inferTime.toFixed(0)}ms`);

      // åˆè¨ˆè¨ˆç®—ï¼ˆãƒ¯ãƒ³ã‚·ãƒ§ãƒƒãƒˆãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼‰
      const totalLoad = yoloResults.loadTime + tesseractResults.loadTime;
      const totalInfer = yoloResults.inferTime + tesseractResults.inferTime;
      document.getElementById('total-load').textContent = `${totalLoad.toFixed(0)}ms`;
      document.getElementById('total-infer').textContent = `${totalInfer.toFixed(0)}ms`;
      document.getElementById('total-mem').textContent = `${getMemoryMB()}MB`;

      // é€Ÿåº¦åˆ¤å®š
      const speedOk = totalInfer < 700;
      setStatus('speed-status', speedOk,
        speedOk ? `âœ… ${totalInfer.toFixed(0)}ms` : `âŒ ${totalInfer.toFixed(0)}ms`);

      // ãƒ¡ãƒ¢ãƒªåˆ¤å®š
      const memMB = parseFloat(getMemoryMB()) || 0;
      const memOk = memMB < 500 || getMemoryMB() === 'N/A';
      setStatus('memory-status', memOk,
        memOk ? `âœ… ${getMemoryMB()}MB` : `âŒ ${memMB}MB`);

      // ç·åˆåˆ¤å®š
      log('\n' + '='.repeat(50));
      log('æ¤œè¨¼çµæœã‚µãƒãƒªãƒ¼');
      log('='.repeat(50));

      const allSuccess = yoloResults.success && tesseractResults.success && speedOk;
      if (allSuccess) {
        log('ğŸ‰ VERDICT: GO - æœ¬æ ¼å®Ÿè£…ã«é€²ã‚ã¾ã™');
        log('');
        log('æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—:');
        log('  1. MIDV-500 ã‹ã‚‰ MRZ ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç”Ÿæˆ');
        log('  2. YOLOv8-nano è»¢ç§»å­¦ç¿’ï¼ˆMRZæ¤œå‡ºç”¨ï¼‰');
        log('  3. ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè£…');
      } else {
        log('âš ï¸  VERDICT: NO-GO - ä»£æ›¿æ¡ˆã‚’æ¤œè¨ã—ã¦ãã ã•ã„');
        if (!yoloResults.success) log('  â†’ YOLOv8: TFLite.js ã‚’æ¤œè¨');
        if (!tesseractResults.success) log('  â†’ Tesseract: åˆ¥ OCR ã‚’æ¤œè¨');
        if (!speedOk) log('  â†’ é€Ÿåº¦: WebGPU or ã‚µãƒ¼ãƒãƒ¼æ¨è«–ã‚’æ¤œè¨');
      }

      log(`\næœ€çµ‚ãƒ¡ãƒ¢ãƒª: ${getMemoryMB()} MB`);

      btn.disabled = false;
      btn.textContent = 'ğŸ”„ å†å®Ÿè¡Œ';
    }

    // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«å…¬é–‹
    window.runAllTests = runAllTests;
  </script>
</body>
</html>
